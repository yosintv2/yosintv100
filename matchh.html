<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YoSinTV Match Center</title>
    <meta name="description" content="Watch Live Football & Cricket Matches">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }

        /* Provided Match Card CSS */
        .match-card {
            display: block;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            /* Lighter shadow for light mode */
            border: 1px solid #e5e7eb;
            padding: 14px;
            margin: 16px auto;
            background: #ffffff;
            width: 100%;
            /* Adjusted for container */
            max-width: 960px;
            transition: all 0.25s;
        }

        .match-card:hover {
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.1);
            border-color: #93c5fd;
        }

        .match-card-content {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .match-row-teams {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 8px;
        }

        .match-team {
            flex-grow: 1;
            flex-basis: 0;
            min-width: 0;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 1;
        }

        .match-team.home {
            justify-content: flex-end;
            text-align: right;
        }

        .match-team.away {
            justify-content: flex-start;
            text-align: left;
        }

        .match-team img {
            width: 48px;
            height: 48px;
            border-radius: 0;
            /* Keep square/natural if needed, or set 50% for circle */
            object-fit: contain;
            flex-shrink: 0;
        }

        .match-team-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1f2937;
            white-space: wrap;
            /* Allow wrapping on small screens */
            line-height: 1.2;
        }

        /* Additional Responsive Styles */
        @media (max-width: 480px) {
            .match-team img {
                width: 36px;
                height: 36px;
            }

            .match-team-name {
                font-size: 0.95rem;
            }
        }

        /* Section containers */
        .section-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.75rem;
            border-bottom: 2px solid #3b82f6;
            display: inline-block;
            padding-bottom: 2px;
        }

        /* Stream Buttons */
        .stream-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px;
            background: #2563eb;
            color: white;
            font-weight: 600;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            transition: background 0.2s;
        }

        .stream-btn:hover {
            background: #1d4ed8;
        }

        /* Lineups */
        .lineup-list li {
            padding: 6px 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lineup-list li:last-child {
            border-bottom: none;
        }

        .player-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #9ca3af;
        }

        /* H2H Bar */
        .h2h-bar-container {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .h2h-bar-fill {
            height: 100%;
            transition: width 1s;
        }

        /* Utility */
        .hidden {
            display: none;
        }
    </style>
</head>

<body class="bg-gray-100">

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between max-w-4xl">
            <a href="https://www.yosin-tv.net/" class="flex items-center gap-2">
                <img src="https://web.cricfoot.net/logo.png" alt="YoSinTV" class="h-8 md:h-10">
                <!-- <span class="font-bold text-gray-800 text-lg">YoSinTV</span> -->
            </a>
            <a href="/" class="text-sm font-medium text-blue-600 hover:text-blue-800">Home</a>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6 max-w-4xl">

        <!-- Loading -->
        <div id="loader" class="text-center py-20">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
            <p class="mt-4 text-gray-500">Loading details...</p>
        </div>

        <div id="match-content" class="hidden">

            <!-- 1. MATCH CARD (User CSS Applied) -->
            <div class="match-card">
                <div class="match-card-content">

                    <!-- Date/Status Header -->
                    <div class="text-center mb-2">
                        <span id="match-status"
                            class="inline-block px-2 py-0.5 rounded text-xs font-bold text-white bg-gray-500">UPCOMING</span>
                        <div id="match-date" class="text-xs text-gray-500 mt-1 font-medium"></div>
                    </div>

                    <!-- Teams Row -->
                    <div class="match-row-teams">
                        <!-- Home -->
                        <div class="match-team home">
                            <span class="match-team-name" id="team1-name">Home Team</span>
                            <img id="team1-logo" src="" alt="Home">
                        </div>

                        <!-- Score / VS -->
                        <div class="text-lg font-black text-gray-300 px-2 shrink-0">VS</div>

                        <!-- Away -->
                        <div class="match-team away">
                            <img id="team2-logo" src="" alt="Away">
                            <span class="match-team-name" id="team2-name">Away Team</span>
                        </div>
                    </div>

                    <!-- Footer Info in Card -->
                    <div
                        class="flex justify-center flex-wrap gap-4 text-xs text-gray-500 mt-2 pt-2 border-t border-gray-100">
                        <span class="flex items-center gap-1">üèüÔ∏è <span id="stadium-text">Unknown</span></span>
                        <span class="flex items-center gap-1">üèÜ <span id="league-text">-</span></span>
                    </div>
                </div>
            </div>

            <!-- 2. STREAM LINKS -->
            <div class="section-card">
                <h3 class="section-title">Live Streams</h3>
                <!-- Ad Slot -->
                <div class="mb-4 text-center bg-gray-50 p-2 rounded">
                    <span class="text-[10px] text-gray-400 block mb-1">ADVERTISEMENT</span>
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5525538810839147"
                        data-ad-slot="4345862479" data-ad-format="horizontal" data-full-width-responsive="true"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>

                <div id="stream-container" class="space-y-2">
                    <p class="text-center text-gray-500 py-4 italic">Links loading...</p>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">Use a VPN if streams are blocked in your region.</p>
            </div>

            <!-- 3. H2H & STATS -->
            <div id="h2h-section" class="section-card hidden">
                <h3 class="section-title">Head-to-Head</h3>
                <div class="flex items-center justify-between text-sm font-bold mb-1">
                    <span id="label-h2h-home" class="text-blue-600">Home</span>
                    <span class="text-gray-400">Draw</span>
                    <span id="label-h2h-away" class="text-red-500">Away</span>
                </div>
                <!-- Visual Bar -->
                <div class="flex h-4 rounded-full overflow-hidden w-full bg-gray-200">
                    <div id="bar-win"
                        class="bg-blue-500 h-full flex items-center justify-center text-[10px] text-white font-bold"
                        style="width: 33%">0</div>
                    <div id="bar-draw"
                        class="bg-gray-400 h-full flex items-center justify-center text-[10px] text-white font-bold"
                        style="width: 33%">0</div>
                    <div id="bar-loss"
                        class="bg-red-500 h-full flex items-center justify-center text-[10px] text-white font-bold"
                        style="width: 33%">0</div>
                </div>
            </div>

            <!-- 4. LINEUPS -->
            <div id="lineups-section" class="section-card hidden">
                <h3 class="section-title">Starting Lineups</h3>

                <!-- Preview Image -->
                <div id="lineup-img-wrapper" class="hidden mb-6">
                    <img id="lineup-image" src="" class="w-full rounded border border-gray-200">
                </div>

                <div class="grid grid-cols-2 gap-2 sm:gap-6">
                    <!-- Home -->
                    <div>
                        <div class="font-bold text-blue-800 border-b border-gray-200 pb-2 mb-2 text-sm sm:text-base"
                            id="lineup-header-home">
                            Home</div>
                        <ul id="lineup-list-home" class="lineup-list"></ul>
                    </div>
                    <!-- Away -->
                    <div>
                        <div class="font-bold text-red-800 border-b border-gray-200 pb-2 mb-2 text-sm sm:text-base"
                            id="lineup-header-away">
                            Away</div>
                        <ul id="lineup-list-away" class="lineup-list"></ul>
                    </div>
                </div>
            </div>

            <!-- 5. INFO -->
            <div class="section-card">
                <h3 class="section-title">Match Info</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                    <div class="flex justify-between border-b pb-2">
                        <span class="text-gray-500">Referee</span>
                        <span class="font-medium" id="val-referee">Unknown</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <span class="text-gray-500">Stadium</span>
                        <span class="font-medium" id="val-stadium">Unknown</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <span class="text-gray-500">League</span>
                        <span class="font-medium" id="val-league">-</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <span class="text-gray-500">Kickoff</span>
                        <span class="font-medium" id="val-time">-</span>
                    </div>
                </div>
            </div>

            <!-- 2. STREAM LINKS (Moved to Bottom) -->
            <div class="section-card">
                <h3 class="section-title">Live Streams</h3>
                <!-- Ad Slot -->
                <div class="mb-4 text-center bg-gray-50 p-2 rounded">
                    <span class="text-[10px] text-gray-400 block mb-1">ADVERTISEMENT</span>
                    <div style="min-height: 90px;">
                        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5525538810839147"
                            data-ad-slot="4345862479" data-ad-format="horizontal"
                            data-full-width-responsive="true"></ins>
                        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                    </div>
                </div>

                <div id="stream-container" class="space-y-2">
                    <p class="text-center text-gray-500 py-4 italic">Links loading...</p>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">Use a VPN if streams are blocked in your region.</p>
            </div>

            <!-- More Matches -->
            <div class="mt-8">
                <h3 class="font-bold text-lg mb-4 text-gray-700">More Matches</h3>
                <div id="more-matches-grid" class="flex flex-col gap-4"></div>
            </div>

        </div>

        <!-- Sticky Bottom Ad -->
        <div id='fixedban' class='fixed bottom-0 left-1/2 -translate-x-1/2 z-[999]'>
            <div class='relative w-[300px] h-[250px] bg-white rounded-t-lg shadow-2xl border border-gray-200'>
                <button onclick="document.getElementById('fixedban').style.display='none'"
                    class='absolute left-1/2 -translate-x-1/2 top-[-30px] bg-white px-3 py-1 rounded-t-lg text-xs font-bold text-gray-500 shadow-sm'>Close
                    Ad</button>
                <div class='w-[300px] h-[250px] overflow-hidden pt-4 flex justify-center'>
                    <ins class='adsbygoogle inline-block w-[300px] h-[250px]' data-ad-client='ca-pub-5525538810839147'
                        data-ad-slot='5912194004'></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-white border-t border-gray-200 py-6 mt-6">
        <div class="text-center text-xs text-gray-400">¬© 2026 YoSinTV</div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const normalize = s => s ? s.toString().toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g, '').replace(/&/g, 'and').replace(/[^a-z0-9]/g, '') : '';
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('yosintv');

            if (!slug) {
                document.getElementById('loader').innerHTML = '<p>No match selected.</p>';
                return;
            }

            const searchKey = normalize(slug);
            let match = null;
            let extraData = {};
            let allMatches = []; // Store for "More Matches"

            const mainApis = ['https://yosintv-api.pages.dev/api/cricket.json', 'https://yosintv-api.pages.dev/api/football.json'];

            // 1. Fetch Main API
            for (const api of mainApis) {
                try {
                    const r = await fetch(api);
                    if (r.ok) {
                        const json = await r.json();
                        if (json.matches) allMatches = [...allMatches, ...json.matches];

                        const found = (json.matches || []).find(m => {
                            const n1 = normalize(m.team1);
                            const n2 = normalize(m.team2);
                            const combo = normalize(m.team1 + 'vs' + m.team2);
                            const detUrl = m.details_url ? normalize(m.details_url) : '';
                            return combo.includes(searchKey) || n1.includes(searchKey) || n2.includes(searchKey) || detUrl.includes('yosintv' + searchKey);
                        });
                        if (found) { match = found; }
                        // Don't break immediately if we want to collect matches from BOTH APIs? 
                        // Actually better to collect all matches for "More Matches" but we found our match.
                        // Let's finish checking other APIs for more matches content if needed, but usually one is enough.
                    }
                } catch (e) { }
            }

            // 2. Fetch Blog API
            try {
                const r = await fetch(`https://blog.cricfoot.net/${slug}.json`);
                if (r.ok) {
                    extraData = await r.json();
                    if (!match && extraData.team1 && extraData.start) {
                        match = extraData;
                    }
                }
            } catch (e) { }

            if (!match) {
                document.getElementById('loader').innerHTML = '<p>Match not found.</p>';
                return;
            }

            // Merge
            const m = {
                ...match,
                ...extraData,
                stadium: extraData.stadium || match.stadium || "Unknown",
                referee: extraData.referee || match.referee || "Unknown",
                h2h: (extraData.h2h && extraData.h2h.length ? extraData.h2h : match.h2h) || [],
                home_lineup: extraData.home_lineup || match.home_lineup || [],
                away_lineup: extraData.away_lineup || match.away_lineup || [],
                events: extraData.events || []
            };

            // --- RENDER ---
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('match-content').classList.remove('hidden');

            // Match Card
            document.getElementById('team1-name').innerText = m.team1;
            document.getElementById('team2-name').innerText = m.team2;

            const setLogo = (id, url, name) => {
                const img = document.getElementById(id);
                img.src = url || `https://ui-avatars.com/api/?name=${name}&background=random`;
                img.onerror = () => { img.src = `https://ui-avatars.com/api/?name=${name}&background=random`; };
            };
            setLogo('team1-logo', m.team1_logo, m.team1);
            setLogo('team2-logo', m.team2_logo, m.team2);

            const dateObj = new Date(m.start);
            document.getElementById('match-date').innerText = dateObj.toLocaleString(undefined, { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            document.getElementById('val-time').innerText = dateObj.toLocaleTimeString();

            // Status Badge & Countdown Logic
            const badge = document.getElementById('match-status');

            const updateTime = () => {
                const now = new Date();
                // If duration is provided use it, else default 100 mins
                const durationMins = m.duration ? parseInt(m.duration) : 120; // 120 mins safe bet for football
                const endObj = new Date(dateObj.getTime() + durationMins * 60000);

                const diff = dateObj - now;

                if (now >= endObj) {
                    badge.innerText = "MATCH ENDED";
                    badge.className = "inline-block px-2 py-0.5 rounded text-xs font-bold text-white bg-gray-500";
                    return;
                }

                if (now >= dateObj && now < endObj) {
                    badge.innerText = "LIVE";
                    badge.className = "inline-block px-2 py-0.5 rounded text-xs font-bold text-white bg-red-600 animate-pulse shadow-lg shadow-red-500/50";
                    return;
                }

                if (diff > 0) {
                    // Countdown
                    const hrs = Math.floor(diff / (1000 * 60 * 60));
                    const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const secs = Math.floor((diff % (1000 * 60)) / 1000);

                    if (hrs > 24) {
                        badge.innerText = "UPCOMING";
                        badge.className = "inline-block px-2 py-0.5 rounded text-xs font-bold text-white bg-blue-500";
                    } else {
                        badge.innerText = `Starts in ${hrs}h ${mins}m ${secs}s`;
                        badge.className = "inline-block px-2 py-0.5 rounded text-xs font-bold text-white bg-blue-600 font-mono";
                    }
                }
            };

            setInterval(updateTime, 1000);
            updateTime(); // Run immediately

            document.getElementById('stadium-text').innerText = m.stadium;
            document.getElementById('val-stadium').innerText = m.stadium;
            document.getElementById('val-referee').innerText = m.referee;
            document.getElementById('league-text').innerText = m.league || "";
            document.getElementById('val-league').innerText = m.league || "";

            // Streams
            const sCont = document.getElementById('stream-container');
            sCont.innerHTML = '';

            let globalStreamIndex = 1;
            const bannedTerms = ['telegram', 'yosintv', 'join']; // Terms to skip if in event name

            if (m.events && m.events.length) {
                m.events.forEach(ev => {
                    const name = ev.name ? ev.name.toLowerCase() : '';
                    if (bannedTerms.some(term => name.includes(term))) {
                        return; // Skip Telegram links etc
                    }

                    const links = ev.links || (ev.link ? [ev.link] : []);
                    if (links.length) {
                        // Removed title
                        links.forEach((link) => {
                            const btn = document.createElement('a');
                            btn.href = link;
                            btn.target = "_blank";
                            btn.className = "stream-btn";
                            btn.innerHTML = `${m.team1} vs ${m.team2} - Live ${globalStreamIndex++}`;
                            sCont.appendChild(btn);
                        });
                    }
                });
            }

            if (sCont.innerHTML === '') {
                sCont.innerHTML = '<p class="text-center text-sm text-gray-500">No streams available yet.</p>';
            }

            // Lineups
            const hasLineups = (m.home_lineup.length > 0) || (m.away_lineup.length > 0) || m.lineup_image_url;
            if (hasLineups) {
                document.getElementById('lineups-section').classList.remove('hidden');
                document.getElementById('lineup-header-home').innerText = m.team1;
                document.getElementById('lineup-header-away').innerText = m.team2;

                const fillList = (id, list) => {
                    const ul = document.getElementById(id);
                    ul.innerHTML = '';
                    if (list && list.length) {
                        list.forEach(p => {
                            ul.innerHTML += `<li><span class="player-dot"></span>${p}</li>`;
                        });
                    } else {
                        ul.innerHTML = '<li class="text-gray-400 italic">No Data</li>';
                    }
                };
                fillList('lineup-list-home', m.home_lineup);
                fillList('lineup-list-away', m.away_lineup);

                if (m.lineup_image_url) {
                    document.getElementById('lineup-image').src = m.lineup_image_url;
                    document.getElementById('lineup-img-wrapper').classList.remove('hidden');
                }
            }

            // H2H
            let stats = m.h2h;
            if (stats && stats.summary) stats = stats.summary;
            if (Array.isArray(stats) && stats.length >= 3) {
                document.getElementById('h2h-section').classList.remove('hidden');
                const [win, draw, loss] = stats;
                const total = win + draw + loss;

                document.getElementById('bar-win').innerText = win;
                document.getElementById('bar-draw').innerText = draw;
                document.getElementById('bar-loss').innerText = loss;

                if (total > 0) {
                    document.getElementById('bar-win').style.width = (win / total * 100) + '%';
                    document.getElementById('bar-draw').style.width = (draw / total * 100) + '%';
                    document.getElementById('bar-loss').style.width = (loss / total * 100) + '%';
                }

                document.getElementById('label-h2h-home').innerText = m.team1;
                document.getElementById('label-h2h-away').innerText = m.team2;
            }

            // More Matches Rendering
            const moreGrid = document.getElementById('more-matches-grid');
            try {
                // Filter current match
                const others = allMatches.filter(x => {
                    const matchIdValid = m.url !== x.url; // Basic dupe check
                    return matchIdValid;
                });

                // Shuffle and Pick 4
                const shuffled = others.sort(() => 0.5 - Math.random()).slice(0, 4);

                if (shuffled.length > 0) {
                    moreGrid.innerHTML = '';
                    shuffled.forEach(sm => {
                        const sDate = new Date(sm.start);
                        const sTime = sDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        // Construct Card HTML
                        // Using same class logic but slightly simpler wrapper
                        const card = `
                        <a href="${sm.details_url || '#'}" class="match-card hover:bg-gray-50 transition-colors block decoration-transparent">
                            <div class="match-card-content">
                                <div class="text-center mb-1">
                                    <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold text-white bg-gray-400">UPCOMING</span>
                                    <div class="text-[10px] text-gray-500 mt-1">${sTime}</div>
                                </div>
                                <div class="match-row-teams">
                                    <div class="match-team home">
                                        <span class="match-team-name text-sm">${sm.team1}</span>
                                        <img src="${sm.team1_logo}" class="w-8 h-8" alt="${sm.team1}">
                                    </div>
                                    <div class="text-sm font-black text-gray-300 px-1">VS</div>
                                    <div class="match-team away">
                                        <img src="${sm.team2_logo}" class="w-8 h-8" alt="${sm.team2}">
                                        <span class="match-team-name text-sm">${sm.team2}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                        `;
                        moreGrid.innerHTML += card;
                    });
                } else {
                    moreGrid.innerHTML = '<p class="text-gray-400 italic text-center col-span-2">No other matches found.</p>';
                }

            } catch (e) { console.error(e); }
        });
    </script>
</body>

</html>
